import{a as V}from"/build/_shared/chunk-DZBG4SEH.js";import{a as C}from"/build/_shared/chunk-SHUP2IJ2.js";import{A as z,X as T,Z as I,a as k,c as R,d as g,r as m,s as y,t as E,z as A}from"/build/_shared/chunk-YIJO5HIW.js";import"/build/_shared/chunk-UW352ANS.js";import{a as J}from"/build/_shared/chunk-HIQ55532.js";import{j as l,q as S}from"/build/_shared/chunk-I66CAUUV.js";import"/build/_shared/chunk-THAA5J2T.js";import{b as h}from"/build/_shared/chunk-DUH7O3SV.js";import{a as F,b as U}from"/build/_shared/chunk-4BW2JWK3.js";import{a as H,c as x,e as w,g as N,r as n}from"/build/_shared/chunk-RVP37ENA.js";import{d as a}from"/build/_shared/chunk-DTKMK5PW.js";var _=a(F());var j=a(H());var B=a(n()),c=(0,j.forwardRef)(({className:r,...t},i)=>(0,B.jsx)(z,{className:U("-scale-x-100",r),muted:!0,...t,ref:i}));c.displayName="SelfView";var q=a(J()),e=a(n());var L=!1;function G(){if(L||typeof document>"u")return;let r="previously loaded",i=sessionStorage.getItem(r)!==null;sessionStorage.setItem(r,Date.now().toString()),i&&fetch("/api/reportRefresh",{method:"POST"}),L=!0}function M(){let{roomName:r}=w(),t=x(),{setJoined:i,userMedia:o,room:O,partyTracks:p}=g(),{videoStreamTrack:P,audioStreamTrack:f,audioEnabled:D}=o,u=l(p.session$),s=l(p.sessionError$);G();let v=new Set(O.otherUsers.filter(d=>d.tracks.audio).map(d=>d.name)).size,$=I(),[b]=N();return(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4",children:[(0,e.jsx)("div",{className:"flex-1"}),(0,e.jsxs)("div",{className:"space-y-4 w-96",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"text-3xl font-bold",children:r}),(0,e.jsxs)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:[`${v} ${v===1?"user":"users"} in the room.`," "]})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(c,{className:"aspect-[4/3] w-full",videoTrack:P}),(0,e.jsx)("div",{className:"absolute left-3 top-3",children:!s&&!u?.sessionId?(0,e.jsx)(C,{className:"text-zinc-100"}):f&&(0,e.jsx)(e.Fragment,{children:D?(0,e.jsx)(R,{audioTrack:f}):(0,e.jsx)(m,{content:"Mic is turned off",children:(0,e.jsxs)("div",{className:"text-white indication-shadow",children:[(0,e.jsx)(S,{type:"micOff"}),(0,e.jsx)(k,{children:"Mic is turned off"})]})})})})]}),s&&(0,e.jsx)("div",{className:"p-3 rounded-md text-sm text-zinc-800 bg-red-200 dark:text-zinc-200 dark:bg-red-700",children:s}),(o.audioUnavailableReason||o.videoUnavailableReason)&&(0,e.jsxs)("div",{className:"p-3 rounded-md text-sm text-zinc-800 bg-zinc-200 dark:text-zinc-200 dark:bg-zinc-700",children:[o.audioUnavailableReason==="NotAllowedError"&&o.videoUnavailableReason===void 0&&(0,e.jsx)("p",{children:"Mic permission was denied."}),o.videoUnavailableReason==="NotAllowedError"&&o.audioUnavailableReason===void 0&&(0,e.jsx)("p",{children:"Camera permission was denied."}),o.audioUnavailableReason==="NotAllowedError"&&o.videoUnavailableReason==="NotAllowedError"&&(0,e.jsx)("p",{children:"Mic and camera permissions were denied."}),o.audioUnavailableReason==="NotAllowedError"&&(0,e.jsxs)("p",{children:["Enable permission",o.audioUnavailableReason&&o.videoUnavailableReason?"s":""," ","and reload the page to join."]}),o.audioUnavailableReason==="DevicesExhaustedError"&&(0,e.jsx)("p",{children:"No working microphone found."}),o.videoUnavailableReason==="DevicesExhaustedError"&&(0,e.jsx)("p",{children:"No working webcam found."}),o.audioUnavailableReason==="UnknownError"&&(0,e.jsx)("p",{children:"Unknown microphone error."}),o.videoUnavailableReason==="UnknownError"&&(0,e.jsx)("p",{children:"Unknown webcam error."})]}),(0,e.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,e.jsx)(h,{onClick:()=>{i(!0),t("room"+(b.size>0?"?"+b.toString():""))},disabled:!u?.sessionId,children:"Join"}),(0,e.jsx)(A,{}),(0,e.jsx)(y,{}),(0,e.jsx)(T,{}),(0,e.jsx)(m,{content:"Copy URL",children:(0,e.jsx)(E,{contentValue:$})})]})]}),(0,e.jsx)("div",{className:"flex flex-col justify-end flex-1",children:(0,e.jsx)(V,{className:"pt-6"})})]})}export{M as default};
