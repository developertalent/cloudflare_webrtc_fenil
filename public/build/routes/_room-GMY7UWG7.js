import{a as te}from"/build/_shared/chunk-SHUP2IJ2.js";import{b as j,c as M,i as Y,j as w,k as K,l as X,m as z,p as Z,q as ee}from"/build/_shared/chunk-I66CAUUV.js";import"/build/_shared/chunk-THAA5J2T.js";import{a as I,b as V}from"/build/_shared/chunk-DUH7O3SV.js";import{a as He}from"/build/_shared/chunk-4BW2JWK3.js";import{a as v,e as D,f as J,m as Q,r as O}from"/build/_shared/chunk-RVP37ENA.js";import{b as $e,d as m}from"/build/_shared/chunk-DTKMK5PW.js";var Ee=$e((Nt,ve)=>{"use strict";ve.exports={}});var ze=m(He());var _=m(v());var re=m(v());function Be(){return navigator.onLine}function qe(){return!0}function Ge(t){return window.addEventListener("online",t),window.addEventListener("offline",t),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",t)}}function se(){return(0,re.useSyncExternalStore)(Ge,Be,qe)}function oe(t){return se()?t.children:t.fallback}var x=m(v());var y=m(O());async function Je(){try{return(await navigator.permissions.query({name:"microphone"})).state}catch{return"unable-to-determine"}}function ne(t){let[e,r]=(0,x.useState)(null),s=(0,x.useRef)(!0);return(0,x.useEffect)(()=>(Je().then(o=>{s.current&&r(o)}),()=>{s.current=!1}),[]),e===null?null:e==="denied"?(0,y.jsx)("div",{className:"grid items-center h-full",children:(0,y.jsxs)("div",{className:"mx-auto space-y-2 max-w-80",children:[(0,y.jsx)("h1",{className:"text-2xl font-bold",children:"Permission denied"}),(0,y.jsx)("p",{children:"You will need to go into your browser settings and manually re-enable permission."})]})}):e==="prompt"?(0,y.jsx)("div",{className:"grid items-center h-full",children:(0,y.jsxs)("div",{className:"mx-auto max-w-80",children:[(0,y.jsx)("p",{className:"mb-8",children:"In order to use Orange Meets, you will need to grant permission to your camera and microphone. You will be prompted for access."}),(0,y.jsx)(V,{onClick:()=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(o=>{s.current&&r("granted"),o.getTracks().forEach(n=>n.stop())}).catch(()=>{s.current&&r("denied")})},children:"Allow access"})]})}):t.children}var T=m(v());var ie=m(v());function U(t){let e=JSON.stringify(t);return(0,ie.useMemo)(()=>JSON.parse(e),[e])}X("debug");var ae=t=>{let e=U(t),r=(0,T.useMemo)(()=>new z(e),[e]),s=w(r.peerConnection$),[o,n]=(0,T.useState)("new");return(0,T.useEffect)(()=>{if(!s)return;n(s.iceConnectionState);let a=()=>{n(s.iceConnectionState)};return s.addEventListener("iceconnectionstatechange",a),()=>{s.removeEventListener("connectionstatechange",a)}},[s]),{partyTracks:r,iceConnectionState:o}};var p=m(v());function F(t,e="Unhandled type: assert never failed"){throw new Error(e)}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var ue=class extends Event{message;error;constructor(t,e){super("error",e),this.message=t.message,this.error=t}},he=class extends Event{code;reason;wasClean=!0;constructor(t=1e3,e="",r){super("close",r),this.code=t,this.reason=e}},$={Event,ErrorEvent:ue,CloseEvent:he};function Qe(t,e){if(!t)throw new Error(e)}function je(t){return new t.constructor(t.type,t)}function Ye(t){return"data"in t?new MessageEvent(t.type,t):"code"in t||"reason"in t?new he(t.code||1999,t.reason||"unknown reason",t):"error"in t?new ue(t.error,t):new Event(t.type,t)}var Ke=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u",W=Ke?Ye:je,S={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},ce=!1,H=class b extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(e,r,s={}){super(),this._url=e,this._protocols=r,this._options=s,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return b.CONNECTING}get OPEN(){return b.OPEN}get CLOSING(){return b.CLOSING}get CLOSED(){return b.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((r,s)=>(typeof s=="string"?r+=s.length:s instanceof Blob?r+=s.size:r+=s.byteLength,r),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?b.CLOSED:b.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(e=1e3,r){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,r)}reconnect(e,r){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,r),this._connect())}send(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{let{maxEnqueuedMessages:r=S.maxEnqueuedMessages}=this._options;this._messageQueue.length<r&&(this._debug("enqueue",e),this._messageQueue.push(e))}}_debug(...e){this._options.debug&&this._debugLogger("RWS>",...e)}_getNextDelay(){let{reconnectionDelayGrowFactor:e=S.reconnectionDelayGrowFactor,minReconnectionDelay:r=S.minReconnectionDelay,maxReconnectionDelay:s=S.maxReconnectionDelay}=this._options,o=0;return this._retryCount>0&&(o=r*Math.pow(e,this._retryCount-1),o>s&&(o=s)),this._debug("next delay",o),o}_wait(){return new Promise(e=>{setTimeout(e,this._getNextDelay())})}_getNextProtocols(e){if(!e)return Promise.resolve(null);if(typeof e=="string"||Array.isArray(e))return Promise.resolve(e);if(typeof e=="function"){let r=e();if(!r)return Promise.resolve(null);if(typeof r=="string"||Array.isArray(r))return Promise.resolve(r);if(r.then)return r}throw Error("Invalid protocols")}_getNextUrl(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){let r=e();if(typeof r=="string")return Promise.resolve(r);if(r.then)return r}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:e=S.maxRetries,connectionTimeout:r=S.connectionTimeout}=this._options;if(this._retryCount>=e){this._debug("max retries reached",this._retryCount,">=",e);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([s,o])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!ce&&(console.error(`\u203C\uFE0F No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),ce=!0);let n=this._options.WebSocket||WebSocket;this._debug("connect",{url:s,protocols:o}),this._ws=o?new n(s,o):new n(s),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),r)}).catch(s=>{this._connectLock=!1,this._handleError(new $.ErrorEvent(Error(s.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new $.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(e=1e3,r){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,r),this._handleClose(new $.CloseEvent(e,r,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=e=>{this._debug("open event");let{minUptime:r=S.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),r),Qe(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(s=>this._ws?.send(s)),this._messageQueue=[],this.onopen&&this.onopen(e),this.dispatchEvent(W(e))};_handleMessage=e=>{this._debug("message event"),this.onmessage&&this.onmessage(e),this.dispatchEvent(W(e))};_handleError=e=>{this._debug("error event",e.message),this._disconnect(void 0,e.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(e),this._debug("exec error listeners"),this.dispatchEvent(W(e)),this._connect()};_handleClose=e=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(e),this.dispatchEvent(W(e))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};var Ve=t=>t[1]!==null&&t[1]!==void 0;function Xe(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let t=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let s=Math.random()*16;return t>0?(s=(t+s)%16|0,t=Math.floor(t/16)):(s=(e+s)%16|0,e=Math.floor(e/16)),(r==="x"?s:s&3|8).toString(16)})}function le(t,e,r={}){let{host:s,path:o,protocol:n,room:a,party:c,prefix:i,query:h}=t,u=s.replace(/^(http|https|ws|wss):\/\//,"");if(u.endsWith("/")&&(u=u.slice(0,-1)),o&&o.startsWith("/"))throw new Error("path must not start with a slash");let d=c??"main",R=o?`/${o}`:"",C=n||(u.startsWith("localhost:")||u.startsWith("127.0.0.1:")||u.startsWith("192.168.")||u.startsWith("10.")||u.startsWith("172.")&&u.split(".")[1]>="16"&&u.split(".")[1]<="31"||u.startsWith("[::ffff:7f00:1]:")?e:e+"s"),k=`${C}://${u}/${i||`parties/${d}/${a}`}${R}`,L=(f={})=>`${k}?${new URLSearchParams([...Object.entries(r),...Object.entries(f).filter(Ve)])}`,P=typeof h=="function"?async()=>L(await h()):L(h);return{host:u,path:R,room:a,name:d,protocol:C,partyUrl:k,urlProvider:P}}var de=class extends H{constructor(t){let e=me(t);super(e.urlProvider,e.protocols,e.socketOptions),this.partySocketOptions=t,this.setWSProperties(e)}_pk;_pkurl;name;room;host;path;updateProperties(t){let e=me({...this.partySocketOptions,...t,host:t.host??this.host,room:t.room??this.room,path:t.path??this.path});this._url=e.urlProvider,this._protocols=e.protocols,this._options=e.socketOptions,this.setWSProperties(e)}setWSProperties(t){let{_pk:e,_pkurl:r,name:s,room:o,host:n,path:a}=t;this._pk=e,this._pkurl=r,this.name=s,this.room=o,this.host=n,this.path=a}reconnect(t,e){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(t,e)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(t,e){let r=le(t,"http"),s=typeof r.urlProvider=="string"?r.urlProvider:await r.urlProvider();return(t.fetch??fetch)(s,e)}};function me(t){let{id:e,host:r,path:s,party:o,room:n,protocol:a,query:c,protocols:i,...h}=t,u=e||Xe(),d=le(t,"ws",{_pk:u});return{_pk:u,_pkurl:d.partyUrl,name:d.name,room:d.room,host:d.host,path:d.path,protocols:i,socketOptions:h,urlProvider:d.urlProvider}}var A=m(v(),1),E=m(v(),1),pe=(t,e)=>{let r=(0,A.useRef)(e);r.current=e,(0,A.useEffect)(()=>{let s=c=>r.current?.onOpen?.(c),o=c=>r.current?.onMessage?.(c),n=c=>r.current?.onClose?.(c),a=c=>r.current?.onError?.(c);return t.addEventListener("open",s),t.addEventListener("close",n),t.addEventListener("error",a),t.addEventListener("message",o),()=>{t.removeEventListener("open",s),t.removeEventListener("close",n),t.removeEventListener("error",a),t.removeEventListener("message",o)}},[t])},fe=t=>[t.startClosed,t.minUptime,t.maxRetries,t.connectionTimeout,t.maxEnqueuedMessages,t.maxReconnectionDelay,t.minReconnectionDelay,t.reconnectionDelayGrowFactor,t.debug];function ye({options:t,createSocket:e,createSocketMemoKey:r}){let s=r(t),o=(0,E.useMemo)(()=>t,[s]),[n,a]=(0,E.useState)(()=>e({...o,startClosed:!0})),c=(0,E.useRef)(null),i=(0,E.useRef)(e);return i.current=e,(0,E.useEffect)(()=>{if(c.current===n){let h=i.current({...o,startClosed:!1});a(h)}else return!c.current&&o.startClosed!==!0&&n.reconnect(),c.current=n,()=>{n.close()}},[n,o]),n}function ge(t){let{host:e,...r}=t,s=ye({options:{host:e||(typeof window<"u"?window.location.host:"dummy-domain.com"),...r},createSocket:o=>new de(o),createSocketMemoKey:o=>JSON.stringify([o.query,o.id,o.host,o.room,o.party,o.path,o.protocol,o.protocols,...fe(o)])});return pe(s,t),s}function B({roomName:t,userMedia:e}){let[r,s]=(0,p.useState)({users:[],ai:{enabled:!1}}),o=(0,p.useRef)(()=>{});(0,p.useEffect)(()=>()=>o.current(),[]);let n=ge({party:"rooms",room:t,onMessage:i=>{let h=JSON.parse(i.data);switch(h.type){case"roomState":if(JSON.stringify(h.state)===JSON.stringify(r))break;s(h.state);break;case"error":console.error("Received error message from WebSocket"),console.error(h.error);break;case"directMessage":break;case"muteMic":e.turnMicOff();break;case"partyserver-pong":case"aiSdp":break;default:F(h);break}}});o.current=()=>n.send(JSON.stringify({type:"userLeft"})),(0,p.useEffect)(()=>{function i(){o.current()}return window.addEventListener("beforeunload",i),()=>{window.removeEventListener("beforeunload",i)}},[n]),(0,p.useEffect)(()=>{let i=setInterval(()=>{n.send(JSON.stringify({type:"heartbeat"}))},5e3);return()=>clearInterval(i)},[n]);let a=(0,p.useMemo)(()=>r.users.find(i=>i.id===n.id),[r.users,n.id]),c=(0,p.useMemo)(()=>r.users.filter(i=>i.id!==n.id&&i.joined),[r.users,n.id]);return{identity:a,otherUsers:c,websocket:n,roomState:r}}var g=m(v());function _e(t,e){let[r,s]=(0,g.useState)([]),[o,n]=(0,g.useState)([]),a=(0,g.useRef)(new Set);(0,g.useEffect)(()=>{let i=()=>{s(t.history.entries)};return t.history.addEventListener("logentry",i),()=>{t.history.removeEventListener("logentry",i)}},[t]),(0,g.useEffect)(()=>{e.otherUsers.forEach(i=>{if(i.transceiverSessionId===void 0||a.current.has(i.transceiverSessionId))return;a.current.add(i.transceiverSessionId);let h={sessionId:i.transceiverSessionId,username:i.name};n(u=>[...u,h])})},[e.otherUsers]);let c=(0,g.useMemo)(()=>o.map(i=>({...i})),[o]);return{apiHistory:r,userSessions:c}}var Ze=m(Ee()),l=m(O());function q(t){if(t)return t.sessionId+"/"+t.trackName}function Se(){return(0,l.jsx)(ne,{children:(0,l.jsx)(oe,{fallback:(0,l.jsx)("div",{className:"grid h-full place-items-center",children:(0,l.jsx)("div",{children:(0,l.jsxs)("h1",{className:"flex items-center gap-3 text-3xl font-black",children:[(0,l.jsx)(ee,{type:"SignalSlashIcon"}),"You are offline"]})})}),children:(0,l.jsx)(et,{})})})}function et(){let{roomName:t}=D();I(t);let e=Z(),r=B({roomName:t,userMedia:e});return r.roomState.meetingId?(0,l.jsx)(rt,{room:r,userMedia:e}):(0,l.jsx)("div",{className:"grid place-items-center h-full",children:(0,l.jsx)(te,{className:"text-gray-500"})})}function tt(t){if(t===void 0||t.getCapabilities===void 0)return{height:0,width:0};let e=t?.getCapabilities().height?.max??0,r=t?.getCapabilities().width?.max??0;return{height:e,width:r}}function rt({room:t,userMedia:e}){let[r,s]=(0,_.useState)(!1),[o,n]=(0,_.useState)(!1),{roomName:a}=D();I(a);let{userDirectoryUrl:c,traceLink:i,feedbackEnabled:h,apiExtraParams:u,iceServers:d,maxWebcamBitrate:R=12e5,maxWebcamFramerate:C=24,maxWebcamQualityLevel:k=1080,maxApiHistory:L=100}=Q(),P=new URLSearchParams(u);I(t.roomState.meetingId,"Meeting ID cannot be missing"),P.set("correlationId",t.roomState.meetingId);let{partyTracks:f,iceConnectionState:be}=ae({maxApiHistory:L,apiExtraParams:P.toString(),iceServers:d}),we=_e(f,t),xe=(0,_.useMemo)(()=>{let N=e.videoStreamTrack,{height:Ae,width:De}=tt(N),Fe=Math.min(Ae,De);return Math.max(Fe/k,1)},[k,e.videoStreamTrack]),Te=U([{maxFramerate:C,maxBitrate:R,scaleResolutionDownBy:xe}]),G=K(Te),ke=(0,_.useMemo)(()=>f.push(e.videoTrack$,G),[f,e.videoTrack$,G]),Re=w(ke),Ce=(0,_.useMemo)(()=>f.push(e.publicAudioTrack$,M([{networkPriority:"high"}])),[f,e.publicAudioTrack$]),Le=w(Ce),Pe=(0,_.useMemo)(()=>e.screenShareVideoTrack$.pipe(Y(N=>N?j(f.push(M(N))):M(void 0))),[f,e.screenShareVideoTrack$]),Ne=w(Pe),[Oe,Me]=(0,_.useState)([]),[Ie,Ue]=(0,_.useState)(!1),We={joined:r,setJoined:s,pinnedTileIds:Oe,setPinnedTileIds:Me,showDebugInfo:Ie,setShowDebugInfo:Ue,dataSaverMode:o,setDataSaverMode:n,traceLink:i,userMedia:e,userDirectoryUrl:c,feedbackEnabled:h,partyTracks:f,roomHistory:we,iceConnectionState:be,room:t,pushedTracks:{video:q(Re),audio:q(Le),screenshare:q(Ne)}};return(0,l.jsx)(J,{context:We})}export{Se as default};
/*! Bundled license information:

partysocket/dist/chunk-4SNNYC7I.mjs:
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
